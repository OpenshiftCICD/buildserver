\section{Entwickler Setup}
\label{sec:dev-setup}
Dieser Abschnitt beschreibt das Aufsetzen einer lokalen Entwicklungsumgebung für die Entwicklung mit Openshift. Es wird davon ausgegangen, dass auf einem Linux System gearbeitet wird.

\subsection{Docker Setup}
Dieser Abschnitt behandelt, dass Einrichten von Docker für die Verwendung von Openshift. Es muss eine aktuelle Version von Docker installiert sein.

\begin{minted}{bash}
# 1. Define insecure registry, which is used by openshift
#    depending on your linux distribution
INSECURE_REGISTRY='--insecure-registry 172.30.0.0/16'

# 2. Reload the docker service
sudo systemctl daemon-reload

# 3.Restart the docker service
sudo systemctl restart docker
\end{minted} 
Die ungesicherte Registry wird von Openshift dazu verwendet, um in Openshift Docker Images zu verwalten. Openshift lädt sich die verwendeten externen Docker Images nur einmal in die lokale Docker \emph{Registry} und verwendet ausschließlich diese Images.

\subsection{Firewall Setup}
Dieser Abschnitt behandelt das Einrichten der Firewall für die Verwendung von Openshift.

\begin{minted}{bash}
# 1. Check docker bridge subnet
docker network inspect 
	-f "{{range .IPAM.Config }}{{ .Subnet }}{{end}}" bridge

# 2. Create new firewall zone
firewall-cmd --permanent --new-zone dockerc

# 3. Add docker bridge network ass source
firewall-cmd --permanent --zone dockerc --add-source 172.17.0.0/16

# 4. Add all ports docker and openshift needs
firewall-cmd --permanent --zone dockerc --add-port 8443/tcp
firewall-cmd --permanent --zone dockerc --add-port 53/udp
firewall-cmd --permanent --zone dockerc --add-port 8053/udp

# 5. Reload the firewall rules
firewall-cmd --reload
	
\end{minted}
\ \newline
Ohne diese Firewall Einstellungen kann kein Docker Container, der in Openshift läuft, DNS Namen auflösen, oder auf das Internet zugreifen.

\subsection{Openshift Setup}
Dieser Abschnitt beschreibt das Einrichten des lokalen Oepnshift \emph{Clusters}.
\newline
\newline
Es werden folgende Ressourcen benötigt, die aus dem Internet heruntergeladen werden können.
\begin{enumerate}
	\item\textbf{\emph{Openshift Client Tools}}
	\newline
	\emph{\url{https://developers.redhat.com/products/openshift/download/}}
	\newline
	Es wird die Version \emph{3.5.5.31.24} benötigt, die unter \emph{älter Versionen} gefunden werden kann.
	\newline
	Es wird ein aktiver JBoss \emph{Developer Account} vorausgesetzt.
	\item\textbf{\emph{openshift-client-wrapper}}
	\newline
	\emph{\url{https://github.com/openshift-evangelists/oc-cluster-wrapper/releases/tag/0.9.3}}:
	\newline
	Bei \emph{oc-cluster-wrapper} handlet es sich um ein Shell-Skript, welches das Arbeiten mit oc erleichtert.
\end{enumerate}
Das \emph{oc} Binary sowie das Skript \emph{oc-cluster-wrapper} müssen in den \emph{PATH} mitaufgenommen werden. Das Skript \emph{oc-cluster-wrapper} verwendet das \emph{oc} Binary, das mit \emph{oc} über den \emph{PATH} angesprochen werden kann.

\subsubsection{Kommandos}
Dieser Abschnitt beschreibt die Kommandos, die für das Kontrollieren des \emph{Cluster}.
\begin{minted}{bash}
# Create or start persistent profile for local cluster named 'ci'
oc-cluster-wrapper up ci

# Stop the local cluster of profile 'ci'
oc-cluster-wrapper down ci

# Delete profile ci and all related cluster data
oc-cluster-wrapper destroy ci
\end{minted}

Wenn beim Starten folgende Fehlermeldung auftritt, dann liegt es daran, dass die Konfiguration nicht mehr gültig, da Sie sich z.B. in einem anderen Netz befinden.
\begin{minted}{bash}
# Command built by oc-cluster-wrapper
oc cluster up --version v3.5.5.31 
--image registry.access.redhat.com/openshift3/ose 
--public-hostname 127.0.0.1 
--routing-suffix apps.127.0.0.1.nip.io 
--host-data-dir /home/het/.oc/profiles/ci/data 
--host-config-dir /home/het/.oc/profiles/ci/config 
--host-pv-dir /home/het/.oc/profiles/ci/pv -
-use-existing-config -e TZ=CET                                                                                                 
-- Checking OpenShift client ... OK   

...

# Resulting error, because the cluster gets startet, 
# when computer is in a different net.
Finding server IP ... 
Using 10.29.18.80 as the server IP
-- Starting OpenShift container ... FAIL
Error: Docker run error rc=2
Details:
Image: registry.access.redhat.com/openshift3/ose:v3.5.5.31
Entrypoint: [/bin/bash]
Command: [-c for name in 10.29.18.80 het.linux.gepardec.com; kma
do ls /var/lib/origin/openshift.local.config/node-$name &> /dev/null 
&& echo $name && break; done]
\end{minted}
\ \newline
Kopieren Sie das \emph{Shell}-Kommando \textbf{\emph{oc cluster up ...}} und entfernen Sie das Argument \textbf{\emph{--use-existing-config}}. Ohne das Argument \textbf{\emph{--use-existing-config}} wird eine neue Konfiguration erstellt.

\subsection{Ultrahook Setup}
Dieser Abschnitt behandelt das Einrichten von Ultrahook, das ein externer Service und eine lokale Applikation ist, mit der auf \emph{Localhost} auf externe \emph{Hooks} reagiert werden kann. Ohne Ultrahook können die \emph{Hooks} nicht lokal getestet werden.

\begin{enumerate}
	\item Registrieren eines \emph{Webhook Namespace} auf \url{http://www.ultrahook.com/register}.
	\item Starten der lokalen Anwendung mit folgenden \emph{Shell}-Kommandos\\
	\inlineBash{ultrahook -k <API_KEY> github <OPENSHIFT_HOOK_URL>}
\end{enumerate}
Jetzt kann auf einer lokalen Maschine auf z.B. Github \emph{Hooks} reagiert werden.